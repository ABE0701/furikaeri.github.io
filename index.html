<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>授業振り返りレポート</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* InterフォントをGoogle Fontsからインポート */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Ultra-light background for the main app */
            min-height: 100vh; /* Ensure body takes full viewport height */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align content to the top */
            align-items: center;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0; /* Light blue-gray track color */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; /* Medium gray thumb color */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* Darker gray thumb on hover */
        }

        /* Chart.js tooltip custom styling */
        .chartjs-tooltip {
            background: rgba(15, 23, 42, 0.9) !important; /* slate-900 with opacity */
            border-radius: 0.5rem !important; /* rounded-lg */
            padding: 0.75rem 1rem !important; /* p-3 px-4 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important; /* shadow-lg */
            font-size: 0.875rem !important; /* text-sm */
            color: #f8fafc !important; /* slate-50 */
            opacity: 1 !important; /* Ensure visibility */
        }
        .chartjs-tooltip-header {
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chartjs-tooltip-body {
            font-weight: 500;
        }
        .chartjs-tooltip-point-box {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 lg:p-12">
    <!-- Main Application Container -->
    <div id="main-app" class="max-w-4xl mx-auto rounded-3xl shadow-2xl overflow-hidden border border-gray-100">
        <!-- Top section with gradient background -->
        <div class="p-6 sm:p-8 md:p-10 lg:p-12 text-white text-center rounded-t-3xl"
             style="background: linear-gradient(135deg, #a78bfa 0%, #818cf8 100%);">
            <h1 class="text-3xl sm:text-4xl font-extrabold mb-4 tracking-tight">授業振り返りレポート</h1>
            <p class="text-lg sm:text-xl font-medium max-w-xl mx-auto mb-10 leading-relaxed opacity-90">
                クラス全体の学習状況を多角的に分析し、<br>生徒一人ひとりの成長をサポートします。
            </p>
            <!-- Tab buttons -->
            <div class="flex rounded-xl bg-white p-2 shadow-inner border border-gray-200">
                <button id="student-tab-btn" class="flex-1 py-3.5 px-5 text-center rounded-lg font-bold text-lg transition-all duration-300 ease-in-out bg-blue-600 text-white shadow-lg hover:bg-blue-700 active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-blue-300">
                    生徒別レポート
                </button>
                <button id="analysis-tab-btn" class="flex-1 py-3.5 px-5 text-center rounded-lg font-semibold text-lg transition-all duration-300 ease-in-out bg-transparent text-gray-700 hover:bg-gray-100 hover:text-gray-900 active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-blue-300">
                    日付ごとの割合分析
                </button>
            </div>
        </div>

        <!-- Content area below the gradient header -->
        <div class="bg-white rounded-b-3xl p-6 sm:p-8 md:p-10 lg:p-12 border border-gray-100 border-t-0">
            <!-- Student Reports Tab Content -->
            <div id="student-reports-tab" class="">
                <h2 class="text-2xl sm:text-3xl font-extrabold text-gray-900 mb-8 tracking-tight">生徒別の学習カルテ</h2>
                <p class="text-gray-700 leading-relaxed text-base mb-8">
                    ドロップダウンメニューから出席番号を選択すると、その生徒個人の学習の軌跡が表示されます。評価点の推移グラフと、各授業での具体的な振り返り内容から、個々の成長と課題を確認できます。
                </p>
                <!-- Student Selector for Student Reports Tab -->
                <div class="mb-10">
                    <label for="student-select" class="block text-gray-800 text-base font-bold mb-3">出席番号を選択:</label>
                    <div class="relative">
                        <select id="student-select" class="block appearance-none w-full bg-white border border-gray-300 text-gray-800 py-3.5 px-5 pr-12 rounded-xl leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 shadow-md text-base">
                            <option value="">出席番号を選択してください</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-600">
                            <svg class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.757 7.586 5.343 9z"/></svg>
                        </div>
                    </div>
                </div>
                <!-- Student Reports Display Area -->
                <div id="student-reports-content" class="space-y-8">
                    <div class="flex items-center justify-center p-16 text-gray-500 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                        <p class="text-xl font-medium">出席番号を選択してレポートを表示してください。</p>
                    </div>
                </div>
            </div>

            <!-- Analysis Tab Content (initially hidden) -->
            <div id="analysis-tab" class="hidden">
                <div id="analysis-content" class="space-y-8">
                    <!-- This content will be dynamically generated by renderAnalysisReports -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Raw report data provided by the user
        const rawReportData = `出席番号: 2
2025年06月02日
今回の授業の目標: 今までの計算方法の応用の因数分解を自分でちゃんと理解して計算できるようにすること
授業で知識が必要だった部分・理解が深まった部分: 因数分解する前に一つの文字に着目して文字に置き換えるところ。またその一旦乗法公式に当てはめてから文字に置き換え、計算する方法をさやちゃんに教えてもらい他の問題も解けることができた。計算する前に一つの文字に着目して計算することでとても計算がしやすくなるということ。自分が使いやすい文字を括りだしてから計算する方法以外にも計算方法があることを知りました。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 文字式が3つ以上ある因数分解をするときに（◯y＋2）xや（yー4）（yー6）などを一つの文字式と考えることと、その考えを持ってたすきかけをして計算するという今までの計算方法を利用するところ。一つの文字式に置き換えてたすきかけをすることが分からなく、さやちゃんに教えてもらい何となく方法を知ることができたこと。
思考・判断: 10点
先生からのコメント: 複雑な因数分解に対して、文字に置き換える工夫を学べたことは素晴らしいですね。さやさんの助けを借りて理解を深められた経験は、今後の学習でも大いに役立つでしょう。様々な解法があることを知るのも、数学の面白さの一つです。
2025年06月03日
今回の授業の目標: 中学校で習った有理数、有限小数、無理数などを復習して理解を深めよう
授業で知識が必要だった部分・理解が深まった部分: 絶対値を表すときに|a|と表せたり、|7+2|などの||のなかに1つ以上の数字があるときに先に計算してから出た数字の絶対値を出せばいいということ。無理数に入るルートを小数にしたものも無理数に入ること。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: |√2−5|の絶対値を求めるときにその数字ごと一つの数字とし、マイナスになっていると考えとマイナスを掛けると絶対値になること。
思考・判断: 8点
先生からのコメント: 絶対値の基本的な表記法から、複雑な形での計算方法まで、しっかりと知識を吸収できていますね。特に|√2−5|のような問題で、符号の変化を考えて絶対値を求める思考力が身についたのは大きな進歩です。
2025年06月10日
今回の授業の目標: ルートを使った分母の有理化の方法を思い出し、因数分解を活用した有理化の方法を覚えよう
授業で知識が必要だった部分・理解が深まった部分: 因数分解の有理化をするときに分子にもその分母にかけたものをかけるときにそのまま計算せずに先に分母の方から計算して約分できたらするという感じでしたら計算しやすくなるというところ。ルートの有理化のときそのまま分母の数をかけるのではなくルート同士で先に計算してからやったほうが楽ということを知りました。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 分母に√5＋√3という物があったときに前に習った因数分解の4番の(x+y)(x-y)=x²-y²を使って有理化すればいいというところ。
思考・判断: 8点
先生からのコメント: 有理化の際に約分を意識したり、因数分解の公式を応用する発想は素晴らしいです。計算をより効率的に進める工夫を自分で見つけられたのは、思考力が身についている証拠ですね。
出席番号: 5
2025年06月02日
今回の授業の目標: 公式を覚える！ なるべく自分がわかりやすいように、簡単に！
授業で知識が必要だった部分・理解が深まった部分: 文字が多い場合、Aとして置く公式。二乗の式の応用のときは｛｝で一つの二乗として置く公式。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 人に教えるときに、今まで習った公式をフル活用したこと。例えば、たすきがけと因数分解をしないと答えられない式。降べきの順にそろえて因数分解やたすきがけなど工夫しないといけない式。
思考・判断: 9点
先生からのコメント: 公式を効率的に覚えるという目標、そしてそれを人に教える中で、多くの公式を総合的に活用できたことは素晴らしい経験ですね。複雑な問題を前に、様々な解法を駆使する思考力も高まっています。
2025年06月03日
今回の授業の目標: 実数について 循環小数の表し方・絶対値
授業で知識が必要だった部分・理解が深まった部分: 自然数や整数などの知識と今まで習った、分数を小数にすることで表す有理数などの部分。理解が深まった部分では、絶対値を|a|と書くところ。 |a|=aが絶対値にするところ。 循環小数では、繰り返される数がありその上に「・」をつけて表すところ。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 絶対値の計算です。 絶対値の中にマイナスがあった場合、マイナスをかけてなくすためそこの思考力が必要だと思った。数直線では、√があった場合のところが深まった。
思考・判断: 8点
先生からのコメント: 実数、循環小数、絶対値といった基本的な概念をしっかり理解できていますね。特に絶対値計算における符号の処理や、√が絡む数直線上の表現について深く考えることができたのは、着実に力がついている証拠です。
2025年06月10日
今回の授業の目標: ルートの公式を分かるようにする。
授業で知識が必要だった部分・理解が深まった部分: ルートの足し算は出来ないことを知識では必要。
知識・技能: 6点
授業で思考力が必要だった場面・思考力が深まった部分: 分母がルートの足し算になってるときは、展開の公式四番を、分母、分子にかけること。
思考・判断: 7点
先生からのコメント: ルートの足し算と掛け算の違いを明確に理解できたことは重要です。また、分母にルートの足し算がある場合の有理化において、因数分解の公式を応用できたのは素晴らしい思考力ですね。
出席番号: 6
2025年06月02日
今回の授業の目標: たすき掛けを使って式を整理し、答えにつなぐ。
授業で知識が必要だった部分・理解が深まった部分: 式をAなどに置き換え、整理すること。また、たすき掛けを使って答えを出すこと。
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: たすき掛けを使う場面、因数分解をする場面を見極めること。
思考・判断: 7点
先生からのコメント: 式の整理とたすき掛けの活用方法を理解し、特にどの場面でどの手法を使うべきかを見極める思考力が身についたのは素晴らしいですね。この見極めは応用問題を解く上で非常に重要になります。
2025年06月03日
今回の授業の目標: 絶対値を理解すること。なぜそうなるのかをしっかりと考えること。
授業で知識が必要だった部分・理解が深まった部分: 絶対値を|a|で表す。−が付く数などはしっかりと−を外すことを理解する
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: 循環小数を分数で表すとこの問題を自分の力で少し考えることができた
思考・判断: 7点
先生からのコメント: 絶対値の意味と表し方について深く理解できたようですね。「なぜそうなるのか」という問いかけは、学習を深める上で非常に大切です。循環小数を分数にする問題に自分で取り組んだ経験は、粘り強く考える力を養うことにつながります。
2025年06月10日
今回の授業の目標: 分母の√を消す計算をできるようにする。有理化をして分母の√を消す。
授業で知識が必要だった部分・理解が深まった部分: √の足し算はできない（掛け算はできる）理解できていなかった部分をひなみちゃんに教えてもらいできるようになった。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 分母が√a+bになっているときには√a-bをかける。できていなかった部分をひなみちゃんに教えてもらい、どうしたら有理化、式の計算になるのかを理解することができた。
思考・判断: 9点
先生からのコメント: 有理化の目的と、そのための具体的な方法を理解できたことは素晴らしいです。特に、ひなみさんに教えてもらいながら、分母が和の形の場合の有理化を理解できたのは、協同学習の良さを最大限に活かせtていますね。
出席番号: 7
2025年06月02日
今回の授業の目標: みんなと協力して、お互いできないところを教え合うことができた
授業で知識が必要だった部分・理解が深まった部分: 例題14みたいな少し複雑な長い式から因数分解して、たすきがけなどを使って問題を解くこと。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: たくさんの計算方法を考え、その問題にあった計算方法を使用すること。
思考・判断: 7点
先生からのコメント: グループ学習で協力し、複雑な因数分解問題に取り組んだ経験は貴重ですね。多様な計算方法の中から最適なものを選ぶ思考力は、今後の学習において非常に役に立つでしょう。協力し合う姿勢も素晴らしいです。
2025年06月03日
今回の授業の目標: 中学の復習、実数についてと絶対値を理解すること
授業で知識が必要だった部分・理解が深まった部分: 実数aに対応する点と原点（0）からの距離を「aの絶対値」といい、｢ |a| 」と書くことがわかった。|-6+3|など一つの||の中に数字が2個以上並んだら先に||の中を計算して、計算して出た数字の絶対値を出せばいいことがわかった。−がつく数は−を外すことを意識した。また、循環小数は繰り返される数の上に「･」が使われていることがわかった。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: |√2−5|の絶対値を考えるのが少し難しかった。でも全部−をかければ絶対値を求められることがわかった。
思考・判断: 8点
先生からのコメント: 絶対値の定義とその計算方法、さらに循環小数の表記まで、幅広い知識を習得できていますね。特に|√2−5|のような問題で、一見複雑に見える形でも冷静に考えることで解法を見つけられたのは、思考力の成長を感じさせます。
2025年06月10日
今回の授業の目標: 例題16のような分母に√5＋√3などの式が入ってる問題で分母を有理化できるようにする。
授業で知識が必要だった部分・理解が深まった部分: 展開するときの公式であった公式4の(🔴＋✖️)(🔴−✖️)の公式を利用するところ
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: 分母を有理化するにはなにをしたら消えるのかよく考えたところ
思考・判断: 6点
先生からのコメント: 分母に和の形がある有理化に対して、展開の公式を応用するという知識が身につきましたね。どうすれば有理化できるかを深く考えることで、問題解決能力が高まっています。
出席番号: 10
2025年06月02日
今回の授業の目標: 自分で問題を解けるようにする。
授業で知識が必要だった部分・理解が深まった部分: たすき掛けのやり方がいまいちわからなかったけど、わかるようになった。
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: たすき掛けをできるように式の形を変形する。
思考・判断: 7点
先生からのコメント: たすき掛けのやり方を理解し、さらにそのために式をどう変形すべきかを考える思考力が身についたのは素晴らしいですね。自分で問題を解けるようになるという目標に向けて、着実に前進しています。
出席番号: 14
2025年06月10日
今回の授業の目標: √を使った計算の仕方(有理化)の復習。有理化を完全に覚える。
授業で知識が必要だった部分・理解が深まった部分: √のある有理化のやり方。答えの約分ができるかどうかの知識(√の中にあるものと外にあるもの)。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 紗弥ちゃんに例題16の有理化を教えてもらいました。√の消し方だったり、因数分解の4番目のやり方で行うことがわかりました。
思考・判断: 9点
先生からのコメント: 有理化の基本から応用まで、深く理解できたようですね。特に、約分に関する知識や、紗弥さんに教えてもらいながら因数分解の公式を応用できた経験は、今後の学習に繋がる貴重な学びです。
出席番号: 16
2025年06月02日
今回の授業の目標: たすき掛けをしっかり使えるようにする
授業で知識が必要だった部分・理解が深まった部分: 因数分解をしてからたすき掛けをするところ
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: 文字や数に着目して解くことが大切だと思った。また、足し間違えなどに気をつける。
思考・判断: 7点
先生からのコメント: たすき掛けのプロセスを理解し、特に文字や数に着目することの重要性を学べたのは素晴らしいです。計算ミスを防ぐ意識も高く、丁寧な学習姿勢が見られます。
2025年06月03日
今回の授業の目標: 絶対値の求め方を覚える
授業で知識が必要だった部分・理解が深まった部分: 絶対値を記号で |a|と表す。|2|と|-2|はどちらも2となるマイナスはつけない。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: |a|の中に入っているものは先に計算してから値を求めることがわかった。また、|a|＋|b|のときはマイナスが付いていても正の数で表されるので引くことはしない。
思考・判断: 8点
先生からのコメント: 絶対値の基本的な定義から、複数の項が含まれる場合の計算順序まで、しっかりと理解できていますね。特に符号の扱いを誤らないよう考える力は、今後の計算問題でも役立つでしょう。
2025年06月10日
今回の授業の目標: ルートの使い方をしっかり覚える
授業で知識が必要だった部分・理解が深まった部分: ルートの足し算は同じ数同士は足すことができるけど、違う数は足すことができないということを学んだ
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: ひなみちゃんに教えてもらって、分母が足し算になってるときはその式のマイナスの式を使うことがわかった。
思考・判断: 9点
先生からのコメント: ルートの足し算におけるルールを明確に理解できたことは重要です。ひなみさんの助けを借りて、分母が足し算がある場合の有理化の方法を習得できたのは、素晴らしい協同学習の成果ですね。
出席番号: 17
2025年06月02日
今回の授業の目標: 授業の内容を理解し、練習問題を自分ひとりで解くことのできるようにする
授業で知識が必要だった部分・理解が深まった部分: 難しい因数分解をたすき掛けを使って解いた
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: 新しい問題を自分一人で解いたとき
思考・判断: 7点
先生からのコメント: たすき掛けを使った難しい因数分解を自力で解けるようになったのは、大きな成長ですね。新しい問題に一人で挑戦する姿勢は、さらなる学びに繋がるでしょう。
2025年06月03日
今回の授業の目標: 練習問題を自分で解けるようにする
授業で知識が必要だった部分・理解が深まった部分: わからなかった問題を先生の話を聞いて解くことができたとき
知識・技能: 6点
授業で思考力が必要だった場面・思考力が深まった部分: 困っている友達に問題の解き方をおしえたとき
思考・判断: 6点
先生からのコメント: 先生の説明でわからなかった問題を理解し、さらにそれを友達に教えることで、自身の理解も深まったようですね。人に教える経験は、知識を定着させる上で非常に効果的です。
2025年06月10日
今回の授業の目標: 分母を有理化できるようにする
授業で知識が必要だった部分・理解が深まった部分: 前の授業で習った公式を利用し問題を解くことができた。
知識・技能: 7点
授業で思考力が必要だった場面・思考力が深まった部分: 困っている大竹さんと對比地さんに問題を教えたとき
思考・判断: 7点
先生からのコメント: 以前学んだ公式を有理化に応用できたのは素晴らしいです。そして、困っている友達に教えることで、自身の知識の定着と応用力がさらに高まったことでしょう。
出席番号: 20
2025年06月02日
今回の授業の目標: 因数分解が解けるようになる
授業で知識が必要だった部分・理解が深まった部分: 因数分解の解き方を理解して、1人で解けたこと
知識・技能: 7点
授業で思考力が必要だった場面・思考力が深まった部分: たすき掛けを使ってうまく計算すること
思考・判断: 6点
先生からのコメント: 因数分解の解き方を理解し、一人で問題が解けるようになったのは素晴らしい成果ですね。特にたすき掛けを効果的に使えたのは、応用力が身についている証拠です。
2025年06月03日
今回の授業の目標: 絶対値がわかるようになる
授業で知識が必要だった部分・理解が深まった部分: 絶対値の表し方がわかったり、求め方が理解できた
知識・技能: 7点
授業で思考力が必要だった場面: あたいの求め方がよく理解出来て、1人で解けるようになった
思考・判断: 6点
先生からのコメント: 絶対値の概念と計算方法をしっかりと理解し、自力で問題が解けるようになったのは大きな進歩です。この調子で、様々な問題に挑戦してみてください。
出席番号: 22
2025年06月02日
今回の授業の目標: 因数分解をできるようにする
授業で知識が必要だった部分・理解が深まった部分: たすき掛けをするために何をするべきなのかや因数分解をするための準備の仕方
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: 新しいたすき掛けをするためにどうやってやるのかを考える
思考・判断: 6点
先生からのコメント: たすき掛けの準備から実行までを理解できたのは素晴らしいですね。新しい問題に対して、どのようにアプローチするかを自分で考える思考力は、学びに非常に重要です。
2025年06月03日
今回の授業の目標: 絶対値を使えるようにする
授業で知識が必要だった部分・理解が深まった部分: √や分数などを数直線に書くことができること
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: 循環型少数などがわかること
思考・判断: 6点
先生からのコメント: √や分数といった様々な数値を数直線上に表現できるようになったのは、数の概念への理解が深まった証拠です。循環小数についても理解ができたとのこと、着実に知識を広げていますね。
2025年06月10日
今回の授業の目標: ルートを使った式をできるようにする
授業で知識が必要だった部分・理解が深まった部分: 中学の時にやったどのように√の式を解くかという考え
知識・技能: 7点
授業で思考力が必要だった場面・思考力が深まった部分: ルートとの分数でどのように式を答えていくのかを考えること
思考・判断: 6点
先生からのコメント: 中学での知識を基礎に、ルートを含む分数式の解き方について深く考えることができたのは素晴らしいです。過去の学びと新しい知識を結びつける思考力は、数学の力を高める上で非常に重要です。
出席番号: 24
2025年06月02日
今回の授業の目標: 今まで勉強した公式を使うことを目標にした。
授業で知識が必要だった部分・理解が深まった部分: マイナスのつけ忘れやケアレスミスが多かった。
知識・技能: 6点
授業で思考力が必要だった場面・思考力が深まった部分: 因数分解の問題でたすきがけラージAを使うことを意識する。
思考・判断: 6点
先生からのコメント: 公式を意識して使うことはもちろん、ケアレスミスに気づき改善しようとする意識はとても大切です。たすき掛けやラージAの置き換えを意識できたのは、より複雑な問題への対応力を高めるでしょう。
2025年06月03日
今回の授業の目標: 新しい単元なので阿部先生が言っていることを理解することを目標にした。
授業で知識が必要だった部分・理解が深まった部分: 単語も出てきて覚えないといけない。
知識・技能: 6点
授業で思考力が必要だった場面・思考力が深まった部分: 練習問題で循環小数が出てきて思考力が深まった。
思考・判断: 6点
先生からのコメント: 新しい単元の専門用語をしっかり覚えようとする姿勢は素晴らしいです。循環小数のような新しい概念に触れ、思考を深めることができたのは大きな学びですね。
2025年06月10日
今回の授業の目標: ルートの計算が苦手なのでしっかりと理解することを目標にした。
授業で知識が必要だった部分・理解が深まった部分: 分母と分子にルートをかけることで有理化ができるようになった。またルートを外しても外の数字を掛けることを忘れないようにしたい。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 例題16の問題でこじまりくたくんに教えてもらい、展開の公式が使われていた。
思考・判断: 9点
先生からのコメント: 苦手なルート計算の有理化を克服できたのは素晴らしいですね。特に、こじまりくたくんとの学び合いを通じて展開の公式を応用する複雑な計算を理解できたのは、協同学習の大きな成果です。
出席番号: 26
2025年06月02日
今回の授業の目標: プラスマイナスをつけ間違えないようにし、因数分解が最後まで解けるようにすること。
授業で知識が必要だった部分・理解が深まった部分: たすき掛けの順番を間違えないようにする。
知識・技能: 7点
授業で思考力が必要だった場面・思考力が深まった部分: 因数分解の整理で自分で考えて答えを出したこと。
思考・判断: 6点
先生からのコメント: 符号のミスに気をつけ、たすき掛けの順序を正確に理解できたことは素晴らしいです。因数分解の整理を自分で考え抜き、答えにたどり着けたのは、思考力と粘り強さの証ですね。
2025年06月03日
今回の授業の目標: 素因数分解のやり方や√の計算方法を覚える。
授業で知識が必要だった部分・理解が深まった部分: ルート計算で素因数分解を利用する場合、根号の中にある数を素因数分解し、2乗の数を見つけてルートの外に出すことを頭で考えて問題に取り組んだ。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 11分の7は素因数分解ではなく分母と分子同士で、約分できることをわからなかった自分に美紅さんが教えてくれた。
思考・判断: 9点
先生からのコメント: 素因数分解を用いたルートの簡略化を頭で考えて実践できたのは素晴らしいです。また、美紅さんから約分について学び、知識を広げられたのも、学習に対する積極的な姿勢の表れですね。
2025年06月10日
今回の授業の目標: ルートの計算で間違えないようによく見直す。
授業で知識が必要だった部分・理解が深まった部分: ルートの中身はルートの中身同士で掛け算をする事根号を含む式の情報は必ず分配法則をすることだと改めて理解できた。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 練習36（2)の計算で(○＋△)²の公式を使って表す計算方法を渡邉さんの教えや先生の解説をよく聞いて理解することができた。
思考・判断: 9点点
先生からのコメント: ルートの掛け算や分配法則について再確認し、理解を深められたのは重要です。特に渡邉さんの助けや解説を通じて、展開の公式を応用する複雑な計算を理解できたのは、着実に力がついている証拠です。
出席番号: 27
2025年06月02日
今回の授業の目標: 最初に自分で考えて理解すること
授業で知識が必要だった部分・理解が深まった部分: たすきがけしたときの答えの書き方が同じで前の授業を振り返る
知識・技能: 7点
授業で思考力が必要だった場面・思考力が深まった部分: 問題が多少ちがくても別の考え方を持って解こうとする
思考・判断: 6点
先生からのコメント: 過去の学習内容を振り返り、たすき掛けの書き方を再確認できたのは良い復習になりましたね。問題の形が少し違っても、柔軟に別の解法を模索する思考力は素晴らしいです。
2025年06月03日
今回の授業の目標: 学んだことを活用して始めてみた問題にも積極的に取り組む
授業で知識が必要だった部分・理解が深まった部分: 循環小数のしくみの意味が理解できた。また問題によって文字を使った式の立て方が身についた。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 答えだけでなくなぜそうなったのかを考えることで理解が深まった。
思考・判断: 6点
先生からのコメント: 循環小数の仕組みを理解し、文字を使った立式ができるようになったのは大きな進歩です。「なぜそうなったのか」と深く考えることで、表面的な理解に留まらない真の学びに繋がっていますね。
2025年06月10日
今回の授業の目標: 解き方や答えを教科書で見る前に自分なりに解く
授業で知識が必要だった部分・理解が深まった部分: 分母に無理数があると計算しにくくなるため、有理化することで式をすっきりさせたり、あとの計算が楽になることがわかり理解が深まった。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 追加問題でもっと簡単に答えを出すやり方を見つけること
思考・判断: 7点
先生からのコメント: 教科書を見る前に自分で考えるという目標、素晴らしいですね！有理化の目的を理解し、計算を楽にする工夫を見つけられたのは、深い学びと応用力の証です。常に最善の解法を模索する姿勢も素晴らしい。
出席番号: 28
2025年06月02日
今回の授業の目標: グループで協力してやり方，解き方を理解することを目標にしました。
授業で知識が必要だった部分・理解が深まった部分: 知識が深まった部分は，因数分解やたすけがけ，くくる部分などに着目して計算することができた。また，グループでできる人とできない人で分かれるためお互いに知識を深められ，わからなかったところを理解して解くことができた。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 相手にわかりやすく教えるためにはどのように伝えれば良いのかという場面で思考力が必要でまた高っまたと思います。
思考・判断: 8点
先生からのコメント: グループ学習で協力し、因数分解やたすき掛けのポイントを理解できたのは素晴らしいですね。特に、相手にわかりやすく教えるためにどう伝えるかを考えることは、自身の理解を深めるだけでなく、コミュニケーション能力も高める貴重な経験です。
2025年06月03日
今回の授業の目標: 循環小数について知ること
授業で知識が必要だった部分・理解が深まった部分: 循環小数をXとして置き換え，方程式を作るという知識が必要だった。桁の数分をXにかけ，方程式を作る部分で理解を深めることができた。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 循環小数を分数に変えるのが難しかったが，自分で調べそこからどのようにして理解をするのかという思考力が必要だった。
思考・判断: 9点
先生からのコメント: 循環小数を分数で表す方法について、方程式を用いた解法を理解できたのは大きな進歩ですね。難しさを感じつつも、自分で調べて理解を深めようとする探求心と思考力は、今後の学習でも非常に重要になります。
出席番号: 32
2025年06月02日
今回の授業の目標: 他の人に教えられること
授業で知識が必要だった部分・理解が深まった部分: たすき掛けをする部分
知識・技能: 6点
授業で思考力が必要だった場面・思考力が深まった部分: 他の人に教える場面
思考・判断: 6点
先生からのコメント: たすき掛けを理解し、さらにそれを人に教えるという目標を設定したのは素晴らしいです。人に教えることで、自身の理解もより確実なものになったことでしょう。
2025年06月03日
今回の授業の目標: 授業の内容をしっかりと覚える
授業で知識が必要だった部分・理解が深まった部分: 小数の繰り返される部分の上に「・」を書く部分
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: どこで繰り返されているのかを見極める部分
思考・判断: 6点
先生からのコメント: 循環小数の表記方法を正確に覚えるという目標、そして、どこが繰り返しの部分なのかを見極める思考力が身についたのは素晴らしいですね。細かい点にも着目できるのは強みです。
2025年06月10日
今回の授業の目標: 内容を理解する
授業で知識が必要だった部分・理解が深まった部分: 分母を有利化させるときに分母と同じ√をかけること
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: どのような√をかけるか考えるとき
思考・判断: 6点
先生からのコメント: 有理化の基本的な知識をしっかりと理解できましたね。特に、どのような√を分母・分子にかけるべきかを自分で考える思考力は、今後の計算問題で非常に役立つでしょう。
出席番号: 33
2025年06月02日
今回の授業の目標: 問題が解けるように友達に聞いたり自分が考えたりする
授業で知識が必要だった部分・理解が深まった部分: 因数分解の長い問題が難しく解けなかったので友達に聞いたりする。たすきがけをちゃんとやる
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: 長い問題の因数分解ではたすきがけをして問題を解く
思考・判断: 6点
先生からのコメント: 難しい問題に対して、友達に質問したり自分で考えたりする積極的な姿勢が素晴らしいですね。長い因数分解問題でたすき掛けを適用できたのは、着実に力がついている証拠です。
出席番号: 34
2025年06月02日
今回の授業の目標: 因数分解する部分とたすき掛けする部分を見分けて計算していくこと
授業で知識が必要だった部分・理解が深まった部分: 1つの文字に着目する計算を忘れないようにする部分
知識・技能: 7点
授業で思考力が必要だった場面・思考力が深まった部分: 式の計算方法を一つだけで考えるんじゃなく、別の計算方法を考えることを意識する
思考・判断: 6点
先生からのコメント: 因数分解とたすき掛けの使い分けを意識できたのは素晴らしいです。一つの解法に固執せず、複数の計算方法を検討する思考力は、数学の問題解決において非常に重要な能力です。
2025年06月03日
今回の授業の目標: 平方根の細かい部分を再確認する。わからない問題は班のみんなでわかるようにすること
授業で知識が必要だった部分・理解が深まった部分: 素因数分解した後にまだ計算ができるところがないかどうかを確認すること。絶対値を理解する
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 小さい数字でも素因数分解ができそうなところは計算して確認するといいと思った。循環小数を分数で表す方法をしっかり考える部分。
思考・判断: 8点
先生からのコメント: 平方根の細部まで確認し、素因数分解後の再確認を徹底しようとする姿勢は素晴らしいです。循環小数を分数で表す方法について深く考えることができたのも、着実に思考力が身についている証拠ですね。
2025年06月10日
今回の授業の目標: わからないところは近くの人に聞いて理解する
授業で知識が必要だった部分・理解が深まった部分: 符号をしっかり見分ける部分
知識・技能: 6点
授業で思考力が必要だった場面・思考力が深まった部分: 有理化の式に他の数が増えてもしっかり落ち着いて計算する
思考・判断: 6点
先生からのコメント: わからないことを周囲に質問し、理解を深めようとする姿勢が素晴らしいです。有理化の際も、焦らず落ち着いて計算を進められる思考力が身についていますね。符号の見極めも重要です。
出席番号: 36
2025年06月02日
今回の授業の目標: いろいろな因数分解を学ぼう
授業で知識が必要だった部分・理解が深まった部分: たすきがけの応用が出てきたので、はじめは難しいと思いましたが、問題を解くうちに解き方を理解することができた。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 答えにたどり着くまでの式を考えるとき
思考・判断: 6点
先生からのコメント: たすき掛けの応用問題に初めは難しさを感じつつも、自力で解き方を理解できたのは素晴らしい成長ですね。答えに至るまでの過程を深く考えることで、問題解決能力が高まっています。
2025年06月03日
今回の授業の目標: 中学校でに習っている内容の復習と、新たに習う内容について学んで知識を広げよう
授業で知識が必要だった部分・理解が深まった部分: ・絶対値の表し方について|a|と表すこと）。・循環小数について（繰り返す数字の最初と最後の数字の上に点「・」をつけること）。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: √の付く場合の数直線上での表し方について（√2=1.41421356, √3=1.732050を語呂で覚えておく）
思考・判断: 8点
先生からのコメント: 中学校での復習から新しい内容まで、幅広く知識を吸収できていますね。特に、√がつく数を数直線上に表す際に、語呂合わせで近似値を覚える工夫は素晴らしいです。
2025年06月10日
今回の授業の目標: ルートを使った計算法を学ぼう。
授業で知識が必要だった部分・理解が深まった部分: 分母の有理化をするとき（ルートが付く場合の足し算の注意など）
知識・技能: 9点
授業で思考力が必要だった場面: ルートの足し算のとき、ルートの中の数字が異なる場合、足し算はできない。有理化の際は、分母の根号（ルート√）を分子と分母のどちらにも掛ける。
思考・判断: 8点
先生からのコメント: ルートの足し算と有理化のルールについて、重要な点をしっかり理解できたようですね。特に、分母に足し算がある場合の有理化の注意点を把握できたのは素晴らしいです。
出席番号: 6
2025年06月16日
今回の授業の目標: 不等式を解けるようにする
授業で知識が必要だった部分・理解が深まった部分: マイナスで割るときは符号を逆にする
知識・技能: 7点
授業で思考力が必要だった場面・思考力が深まった部分: a＜bで割り切れないときはX＜分数にしてとく
思考・判断: 8点
先生からのコメント: 不等式の基本的なルールをしっかりと理解できましたね。特にマイナスで割るときの符号の向きの変化は重要です。割り切れない場合の表現方法についても思考を深められているようです。
出席番号: 16
2025年06月16日
今回の授業の目標: 一次不等式の解き方をマスターする
授業で知識が必要だった部分・理解が深まった部分: 一次不等式はルールは方程式と同じ解き方で、移行をすることがわかった。また、式をわるときはーが＋になったり、＋がーになることもわかった。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 割ったときにーや＋のつけ間違えなどに気をつけることが大切だと思った。
思考・判断: 7点
先生からのコメント: 一次不等式の基本的な解法をマスターできたようですね。方程式との共通点や、符号の変化に注意するべき点も理解できています。計算ミスを防ぐ意識も高く、丁寧な学習姿勢が見られます。
出席番号: 17
2025年06月16日
今回の授業の目標: 一次不等式の解き方を知ろう
授業で知識が必要だった部分・理解が深まった部分: 両辺を負の数で割っているときは不等号の向きが変わることやかっこを含む不等式はカッコを外してから問題を解くということがわかった
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: やったことのない問題を解いたとき
思考・判断: 6点
先生からのコメント: 一次不等式の重要なルールをしっかりと理解できたようですね。特に負の数で割る際の不等号の向きの変化や、カッコを含む不等式の解き方を学べたのは大きな進歩です。未知の問題にも積極的に取り組む姿勢が素晴らしいです。
出席番号: 22
2025年06月16日
今回の授業の目標: 不等号を使えるようにする
授業で知識が必要だった部分・理解が深まった部分: 今回は、マイナスとプラスがありマイナスは、不等号の向きが変わったりしたので難しかったが移行するとマイナスになるという知識が必要だった。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 樋口くんに答え合わせをしてもらったり對比地くんにおしえたりした
思考・判断: 8点
先生からのコメント: 不等号の扱い、特にマイナス符号での変化や移行のルールを理解できたのは素晴らしいです。樋口くんとの答え合わせや對比地くんへの指導を通じて、知識の定着と応用力がさらに高まったことでしょう。
出席番号: 24
2025年06月16日
今回の授業の目標: 不等号の解き方やルールを理解することを目標にした。
授業で知識が必要だった部分・理解が深まった部分: 移行を忘れずにできた。また、移行をするときにマイナスを外して移行したり問題をやる内に凡ミスが多くなっていたので問題が多くてもしっかりと凡ミスをしないようにしたい。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 分母がマイナスになると不等号が変わることを忘れることが多く間違いが多かった。けど途中からミスが減り問題がスラスラ解けるようになった。
思考・判断: 9点
先生からのコメント: 不等号の解き方やルールを目標に掲げ、移行の際の注意点や凡ミスへの意識など、自己の課題を具体的に捉えられていますね。特に、間違いから学び、問題をスムーズに解けるようになったのは、努力の成果です。
出席番号: 32
2025年06月16日
今回の授業の目標: 1次不等式を理解する
授業で知識が必要だった部分・理解が深まった部分: 移行をするとき
知識・技能: 6点
授業で思考力が必要だった場面・思考力が深まった部分: 負の数で割るときに不等式の向きが変わる
思考・判断: 7点
先生からのコメント: 1次不等式に関する基本的な理解は進んでいるようですね。移行のルールや、負の数で割る際の不等号の向きの変化といった重要な点に注目できたのは素晴らしいです。
出席番号: 14
2025年06月16日
今回の授業の目標: 不等式と1次不等式をわかるようにする。
授業で知識が必要だった部分・理解が深まった部分: 1次不等式は方程式の解き方で解を求めること。（）があったらまず分配法則に直してから計算。移行するときは符号が変わる。負の数で割るときは、不等号の向きが変わること。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: x＋3＝7をx＝の形にするのに、両辺から3を引くとx＋3=7→x＋3ー3＝7ー3になるから移行するとx＝7ー3になってx＝4になること。
思考・判断: 9点
先生からのコメント: 1次不等式の基本的なルールをしっかりと理解できていますね。方程式との関連性や、分配法則、移行、負の数で割る際の不等号の向きの変化といった重要な知識が身についています。具体的な計算例を用いて説明できる思考力も素晴らしいです。
出席番号: 2
2025年06月16日
今回の授業の目標: 不等式の性質をしっかり覚えてから一次不等式を解けるようにしよう
授業で知識が必要だった部分・理解が深まった部分: 1＜4の両辺にー2を掛けると今まで＋同士の掛け算や引き算、足し算をしても変わらなかった不等式が変わることからーの数は0に近ければ近いほど大きいものとなることがより理解が深まることができました。a＜bの場合、aー4とbー4の問題があるときマイナスを掛けていないのでそのままaー4＜bー4になること。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: ー3x＜12の問題のとき、ただxに掛けられている余計なものを割ってそのままx＜ー4とするのではなくマイナスで割ったときに向きが変わるのでx＞4となることから、よく自分が何をしたのか（足す、引く、掛ける、割るなど）、どういう答えが出てきたのかをちゃんと確認してから答えを出していきたいです。
思考・判断: 9点
先生からのコメント: 不等式の性質について、具体的な数値例や文字式を用いて深く考察できていますね。負の数で割る際の不等号の向きの変化を正確に理解し、自身の思考プロセスを言語化できているのは素晴らしいです。計算前の確認や、自身の操作を振り返る姿勢も非常に高く評価できます。
出席番号: 5
2025年06月16日
今回の授業の目標: 不等式の解き方について理解する
授業で知識が必要だった部分・理解が深まった部分: 知識が必要だった部分では、-3x＜12を負の数で割ると不等号の向きが変わるところで前の授業でもふれた部分だったので気をつけようと思ったこと。
知識・技能: 9点
授業で思考力が必要だった場面・思考力が深まった部分: 思考力では、ただ計算するだけじゃなくてその符号の意味を知ることが大切だと思った。例えば[x-2＜3]の式で答えが[x＜5]だったらXは5より大きいという考えになりちゃんと成り立っていることが証明されたところ。
思考・判断: 9点
先生からのコメント: 負の数で割る際の不等号の向きの変化という、不等式の重要なポイントをしっかりと押さえられていますね。単に計算できるだけでなく、その符号の意味を理解しようと深く考える姿勢、そして具体的な例で成り立つことを証明しようとする思考力は大変素晴らしいです。
出席番号: 7
2025年06月16日
今回の授業の目標: 一次不等式をとけるようにし、符号などちょっとしたミスを無くすようにしたい
授業で知識が必要だった部分・理解が深まった部分: 一次不等式は例えば7x+3≧4xなどで7x−4x≧−3など移項してx≧−1という答えを出すというような方程式と同じやり方で解くことができるところ。また、負の数で＞（≧）と＜（≦）との関係が変わるというところ。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: 負の数で割るのか正の数で割るのかで負の数で割るならしっかり符号を変えるところの判断。不等式に使用される記号＞＜≧≦の意味をしっかり理解して値はxより大きい（小さい）のか、xは値より小さいか（大きい）を確認して問題が何を知りたいのか忘れないようにしたいと思いました
思考・判断: 9点
先生からのコメント: 一次不等式と方程式の共通点や、負の数で割る際の不等号の向きの変化を正確に理解できていますね。特に、記号の意味を深く理解し、問題が何を求めているのかを常に意識する判断力は、非常に素晴らしいです。細かなミスをなくそうとする目標も高く評価できます。
出席番号: 26
2025年06月16日
今回の授業の目標: 1次不等式をとけるようにする。
授業で知識が必要だった部分・理解が深まった部分: 1次不等式のルールは方程式と同じで、xの邪魔な数字は移行をすることを忘れないようにすること。:-3x＜12の問題を例に、xにーがついていて割る場合不等号の向きが変わるが、＋の場合は記号は変化しないことによく先生の話を聞いて問題に取り組み、渡邉合って合ってるか確認をした。
知識・技能: 10点
授業で思考力が必要だった場面・思考力が深まった部分: -3x＜12の問題を例に、xにーがついていて割る場合不等号の向きが変わるが、＋の場合は記号は変化しないことによく先生の話を聞いて問題に取り組み、渡邉合って合ってるか確認をした。
思考・判断: 9点
先生からのコメント: 1次不等式の基本ルールと方程式との関連性をしっかりと把握できていますね。特に、負の数で割る場合の不等号の変化について、具体的な例で深く理解できたのは素晴らしいです。渡邉さんとの確認を通じて、さらに知識を定着させられたのも、自主的な学習姿勢の表れです。
出席番号: 36
2025年06月16日
今回の授業の目標: 先生の話をしっかり聞いて理解しよう。
授業で知識が必要だった部分・理解が深まった部分: 一次不等式で、大なり小なりの向きが場合によって変わること。
知識・技能: 8点
授業で思考力が必要だった場面・思考力が深まった部分: わからない問題について、先生の解説を聞いた時。
思考・判断: 6点
先生からのコメント: 一次不等式における不等号の向きの変化という重要なルールをしっかりと理解できていますね。先生の解説を注意深く聞くことで、分からない点を解消しようとする学習姿勢は素晴らしいです。`;

        // Object to store parsed reports, keyed by student ID
        let parsedReports = {};
        let allDates = []; // Global array to store all unique dates

        // Function to parse the raw text data
        function parseReportData(data) {
            const studentBlocks = data.split(/出席番号: (\d+)\n/).slice(1);
            // Re-initialize allDates for a fresh parse
            allDates = [];
            parsedReports = {}; // Re-initialize parsedReports

            for (let i = 0; i < studentBlocks.length; i += 2) {
                const studentId = studentBlocks[i].trim();
                const studentDataFragment = studentBlocks[i + 1];

                // Ensure the array for this student exists
                if (!parsedReports[studentId]) {
                    parsedReports[studentId] = [];
                }

                const reports = studentDataFragment.split(/(\d{4}年\d{2}月\d{2}日)\n/).slice(1);

                for (let j = 0; j < reports.length; j += 2) {
                    const date = reports[j].trim();
                    const reportContent = reports[j + 1];

                    const objectiveMatch = reportContent.match(/今回の授業の目標:\s*(.*?)(?:\n授業で知識が必要だった部分|$)/s);
                    const knowledgeMatch = reportContent.match(/授業で知識が必要だった部分・理解が深まった部分:\s*(.*?)\n知識・技能:\s*(\d+)点/s);
                    const thinkingMatch = reportContent.match(/授業で思考力が必要だった場面・思考力が深まった部分:\s*(.*?)\n思考・判断:\s*(\d+)点/s);
                    const commentMatch = reportContent.match(/先生からのコメント:\s*(.*)/s);

                    const objective = objectiveMatch ? objectiveMatch[1].trim() : 'N/A';
                    const knowledgeText = knowledgeMatch ? knowledgeMatch[1].trim() : 'N/A';
                    const knowledgeScore = knowledgeMatch ? parseInt(knowledgeMatch[2]) : 'N/A';
                    const thinkingText = thinkingMatch ? thinkingMatch[1].trim() : 'N/A';
                    const thinkingScore = thinkingMatch ? parseInt(thinkingMatch[2]) : 'N/A';
                    const teacherComment = commentMatch ? commentMatch[1].trim() : 'N/A';

                    // Check if a report for this student and date already exists to prevent duplicates
                    const existingReportIndex = parsedReports[studentId].findIndex(r => r.date === date);

                    const newReport = {
                        date: date,
                        objective: objective,
                        knowledge: {
                            text: knowledgeText,
                            score: knowledgeScore
                        },
                        thinking: {
                            text: thinkingText,
                            score: thinkingScore
                        },
                        comment: teacherComment
                    };

                    if (existingReportIndex > -1) {
                        // Update existing report if found (this handles the score updates)
                        parsedReports[studentId][existingReportIndex] = newReport;
                    } else {
                        // Add new report
                        parsedReports[studentId].push(newReport);
                    }

                    // Collect all unique dates - this part is fine
                    if (!allDates.includes(date)) {
                        allDates.push(date);
                    }
                }
            }
            // Sort allDates chronologically
            allDates.sort((a, b) => new Date(a.replace(/年|月/g, '/').replace(/日/, '')) - new Date(b.replace(/年|月/g, '/').replace(/日/, '')));

            // After all parsing, ensure each student's reports are sorted by date
            Object.keys(parsedReports).forEach(studentId => {
                parsedReports[studentId].sort((a, b) => new Date(a.date.replace(/年|月/g, '/').replace(/日/, '')) - new Date(b.date.replace(/年|月/g, '/').replace(/日/, '')));
            });
        }

        // Function to render reports for a selected student
        function renderStudentReports(studentId) {
            const reportsContainer = document.getElementById('student-reports-content');
            reportsContainer.innerHTML = ''; // Clear previous reports

            if (!studentId) {
                reportsContainer.innerHTML = `
                    <div class="flex items-center justify-center p-16 text-gray-500 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                        <p class="text-xl font-medium">出席番号を選択してレポートを表示してください。</p>
                    </div>
                `;
                return;
            }

            const studentReports = parsedReports[studentId];

            if (!studentReports || studentReports.length === 0) {
                reportsContainer.innerHTML = `
                    <div class="flex items-center justify-center p-16 text-red-600 bg-red-50 rounded-2xl shadow-inner border border-red-200">
                        <p class="text-2xl font-bold">この生徒はまだレポートを提出していません。</p>
                    </div>
                `;
                return;
            }

            allDates.forEach(date => {
                const reportForDate = studentReports.find(report => report.date === date);

                if (reportForDate) {
                    const reportCard = document.createElement('div');
                    reportCard.className = 'bg-white p-6 rounded-2xl shadow-lg border-t-4 border-blue-500';
                    reportCard.innerHTML = `
                        <h3 class="text-xl font-bold text-gray-800 mb-4">${reportForDate.date}</h3>
                        <div class="mb-4">
                            <p class="text-base text-gray-600 font-semibold mb-2">今回の授業の目標:</p>
                            <p class="text-gray-800 ml-2 leading-relaxed">${reportForDate.objective}</p>
                        </div>
                        <div class="flex flex-col sm:flex-row sm:space-x-6 mb-4">
                            <div class="flex-1 bg-blue-50 p-5 rounded-xl border border-blue-200 mb-4 sm:mb-0 shadow-sm">
                                <p class="text-base text-blue-700 font-semibold mb-2">知識・技能:</p>
                                <p class="text-blue-800 text-sm leading-relaxed">${reportForDate.knowledge.text}</p>
                            </div>
                            <div class="flex-1 bg-green-50 p-5 rounded-xl border border-green-200 shadow-sm">
                                <p class="text-base text-green-700 font-semibold mb-2">思考・判断:</p>
                                <p class="text-green-800 text-sm leading-relaxed">${reportForDate.thinking.text}</p>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-5 rounded-xl mt-4 border border-yellow-300 shadow-sm">
                            <p class="text-base text-amber-700 font-semibold mb-2">先生からのコメント:</p>
                            <p class="text-amber-800 ml-2 leading-relaxed">${reportForDate.comment}</p>
                        </div>
                    `;
                    reportsContainer.appendChild(reportCard);
                } else {
                    const notSubmittedCard = document.createElement('div');
                    notSubmittedCard.className = 'bg-gray-100 p-10 rounded-2xl shadow-inner border-t-4 border-gray-400 text-center';
                    notSubmittedCard.innerHTML = `
                        <h3 class="text-xl font-bold text-gray-700 mb-4">${date}</h3>
                        <p class="text-3xl font-extrabold text-red-500">未提出</p>
                        <p class="text-gray-600 mt-2">この日付のレポートは提出されていません。</p>
                    `;
                    reportsContainer.appendChild(notSubmittedCard);
                }
            });
        }

        // Data for analysis page
        let analysisData = {};

        function aggregateAnalysisData() {
            analysisData = {}; // Reset

            allDates.forEach(date => {
                analysisData[date] = {
                    totalStudents: 0,
                    knowledgeScores: {},
                    thinkingScores: {},
                    allSubmittedReports: [] // Store all reports for the current date
                };

                // Initialize scores 0-10 for complete distribution
                for(let i = 0; i <= 10; i++) {
                    analysisData[date].knowledgeScores[i] = 0;
                    analysisData[date].thinkingScores[i] = 0;
                }

                let studentsForThisDate = 0;
                Object.keys(parsedReports).forEach(studentId => {
                    const studentReports = parsedReports[studentId];
                    const reportForDate = studentReports.find(report => report.date === date);

                    if (reportForDate) {
                        studentsForThisDate++;
                        const ks = reportForDate.knowledge.score;
                        const ts = reportForDate.thinking.score;

                        if (typeof ks === 'number') {
                            analysisData[date].knowledgeScores[ks] = (analysisData[date].knowledgeScores[ks] || 0) + 1;
                        }
                        if (typeof ts === 'number') {
                            analysisData[date].thinkingScores[ts] = (analysisData[date].thinkingScores[ts] || 0) + 1;
                        }

                        // Add all submitted reports for this date
                        if (typeof ks === 'number' && typeof ts === 'number') {
                            analysisData[date].allSubmittedReports.push({
                                studentId: studentId,
                                objective: reportForDate.objective,
                                knowledgeText: reportForDate.knowledge.text,
                                knowledgeScore: ks,
                                thinkingText: reportForDate.thinking.text,
                                thinkingScore: ts,
                                comment: reportForDate.comment,
                                totalScore: ks + ts
                            });
                        }
                    }
                });
                analysisData[date].totalStudents = studentsForThisDate;

                // Calculate averages
                let totalKnowledgeScore = 0;
                let totalThinkingScore = 0;
                let submittedStudentsCount = 0;
                Object.values(parsedReports).forEach(studentReports => {
                    const report = studentReports.find(r => r.date === date);
                    if (report && typeof report.knowledge.score === 'number' && typeof report.thinking.score === 'number') {
                        totalKnowledgeScore += report.knowledge.score;
                        totalThinkingScore += report.thinking.score;
                        submittedStudentsCount++;
                    }
                });
                analysisData[date].avgKnowledge = submittedStudentsCount > 0 ? (totalKnowledgeScore / submittedStudentsCount).toFixed(1) : 'N/A';
                analysisData[date].avgThinking = submittedStudentsCount > 0 ? (totalThinkingScore / submittedStudentsCount).toFixed(1) : 'N/A';
            });
            console.log("Analysis Data:", analysisData); // For debugging
        }

        // Function to generate shades of a color
        function generateShades(baseColor, count) {
            const shades = [];
            const r = parseInt(baseColor.substring(1, 3), 16);
            const g = parseInt(baseColor.substring(3, 5), 16);
            const b = parseInt(baseColor.substring(5, 7), 16);

            for (let i = 0; i < count; i++) {
                // Adjust factor to ensure 10 is darkest, 0 is lightest
                // We want highest score (index 10) to be darkest, lowest (index 0) to be lightest.
                // Factor ranges from 0 (lightest, score 0) to 1 (darkest, score 10).
                const factor = i / (count - 1); 
                const blendR = Math.round(r * factor + 255 * (1 - factor));
                const blendG = Math.round(g * factor + 255 * (1 - factor));
                const blendB = Math.round(b * factor + 255 * (1 - factor));
                shades.push(`rgb(${blendR}, ${blendG}, ${blendB})`);
            }
            return shades;
        }

        // Define base colors for Knowledge and Thinking
        const baseBlue = '#2563EB'; // Tailwind blue-600
        const baseGreen = '#059669'; // Tailwind emerald-600 (darker green)

        // Generate shades for scores (0 to 10 points, so 11 shades)
        // Note: Array index 0 will be for score 0, index 10 for score 10.
        const knowledgeColors = generateShades(baseBlue, 11);
        const thinkingColors = generateShades(baseGreen, 11);

        // Function to render analysis reports with charts
        function renderAnalysisReports() {
            const analysisContainer = document.getElementById('analysis-content');
            // Clear previous analysis content for dynamic re-rendering
            analysisContainer.innerHTML = `
                <h2 class="text-2xl sm:text-3xl font-extrabold text-gray-900 mb-8 tracking-tight">授業日ごとの点数割合</h2>
                <p class="text-gray-700 leading-relaxed text-base mb-8">
                    ここでは、各授業日における「知識の習得」と「思考力の深化」の各点数を取得した生徒の割合を円グラフで表示します。また、その日の生徒の感想もいくつか掲載しています。
                </p>
                <div id="date-tabs" class="flex mb-8 rounded-xl bg-gray-50 p-1.5 shadow-inner border border-gray-200"></div>
                <div id="date-analysis-content"></div>
            `;

            const dateTabsContainer = document.getElementById('date-tabs');
            const dateAnalysisContent = document.getElementById('date-analysis-content');

            // Create date tabs
            allDates.forEach((date, index) => {
                const button = document.createElement('button');
                button.id = `date-tab-${index}`;
                button.className = `flex-1 py-3.5 px-5 text-center rounded-lg font-bold text-lg transition-all duration-300 ease-in-out ${index === 0 ? 'bg-blue-600 text-white shadow-md' : 'bg-transparent text-gray-700 hover:bg-gray-100 hover:text-gray-900'} active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-blue-300`;
                button.textContent = date.split('年')[1].replace('月', '月').replace('日', '日'); // Format to "6月2日"
                button.addEventListener('click', () => showDateAnalysis(date, index));
                dateTabsContainer.appendChild(button);
            });

            // Show initial date analysis
            if (allDates.length > 0) {
                showDateAnalysis(allDates[0], 0);
            } else {
                dateAnalysisContent.innerHTML = `
                    <div class="flex items-center justify-center p-16 text-gray-500 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                        <p class="text-xl font-medium">分析データがありません。レポートがまだ提出されていない可能性があります。</p>
                    </div>
                `;
            }
        }

        let currentChartInstances = {}; // Store chart instances to destroy before re-rendering

        function showDateAnalysis(date, tabIndex) {
            const dateAnalysisContent = document.getElementById('date-analysis-content');
            dateAnalysisContent.innerHTML = ''; // Clear previous content for new date's analysis

            // Update tab button styles
            allDates.forEach((d, i) => {
                const btn = document.getElementById(`date-tab-${i}`);
                if (btn) { // Ensure button exists before manipulating classes
                    if (i === tabIndex) {
                        btn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                        btn.classList.remove('bg-transparent', 'text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
                    } else {
                        btn.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                        btn.classList.add('bg-transparent', 'text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
                    }
                }
            });

            const dataForDate = analysisData[date];
            if (!dataForDate || dataForDate.totalStudents === 0) {
                dateAnalysisContent.innerHTML = `
                    <div class="flex items-center justify-center p-16 text-gray-500 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                        <p class="text-xl font-medium">この日の分析データはありません。</p>
                    </div>
                `;
                return;
            }

            // Destroy existing charts before rendering new ones
            for (const chartId in currentChartInstances) {
                if (currentChartInstances[chartId]) {
                    currentChartInstances[chartId].destroy();
                }
            }
            currentChartInstances = {}; // Reset

            // Sort all submitted reports for the date by knowledgeScore (descending) and take top 5
            const topKnowledgeStudents = [...dataForDate.allSubmittedReports].sort((a, b) => b.knowledgeScore - a.knowledgeScore).slice(0, Math.min(5, dataForDate.allSubmittedReports.length));
            // Sort all submitted reports for the date by thinkingScore (descending) and take top 5
            const topThinkingStudents = [...dataForDate.allSubmittedReports].sort((a, b) => b.thinkingScore - a.thinkingScore).slice(0, Math.min(5, dataForDate.allSubmittedReports.length));


            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'bg-white p-8 rounded-2xl shadow-xl border border-gray-100';
            sectionDiv.innerHTML = `
                <h3 class="text-2xl font-bold text-gray-900 mb-5">${date} : 点数別生徒割合</h3>
                <p class="text-gray-700 mb-2">この日の生徒総数: <span class="font-bold text-gray-900">${dataForDate.totalStudents}名</span></p>
                <p class="text-gray-700 mb-8">平均点: 知識の習得 <span class="font-bold text-blue-600">${dataForDate.avgKnowledge}点</span>、思考力の深化 <span class="font-bold text-emerald-600">${dataForDate.avgThinking}点</span></p>

                <div class="flex flex-col md:flex-row md:space-x-10 mb-12">
                    <div class="flex-1 mb-8 md:mb-0 bg-gray-50 p-6 rounded-2xl shadow-md border border-gray-200">
                        <h4 class="text-xl font-semibold text-blue-700 mb-5 text-center">知識の習得</h4>
                        <canvas id="knowledgeChart-${date}"></canvas>
                    </div>
                    <div class="flex-1 bg-gray-50 p-6 rounded-2xl shadow-md border border-gray-200">
                        <h4 class="text-xl font-semibold text-emerald-700 mb-5 text-center">思考力の深化</h4>
                        <canvas id="thinkingChart-${date}"></canvas>
                    </div>
                </div>

                <div class="learning-content mb-12 p-6 bg-gray-50 rounded-2xl shadow-md border border-gray-200">
                    <h4 class="text-xl font-bold text-gray-900 mb-4">この日の学習の内容</h4>
                    <p class="text-gray-700 leading-relaxed text-base">${getLearningContentForDate(date)}</p>
                </div>

                <div class="high-rated-feedback">
                    <h4 class="text-xl font-bold text-gray-900 mb-6">この日の高評価だった生徒の感想</h4>
                    
                    <!-- New Tabs for Feedback -->
                    <div class="flex mb-8 rounded-xl bg-gray-100 p-1.5 shadow-inner border border-gray-200">
                        <button id="feedback-knowledge-tab-btn-${date}" class="flex-1 py-3 px-4 text-center rounded-lg font-semibold transition-all duration-300 ease-in-out bg-blue-600 text-white shadow-md hover:bg-blue-700 active:scale-95">
                            知識・技能
                        </button>
                        <button id="feedback-thinking-tab-btn-${date}" class="flex-1 py-3 px-4 text-center rounded-lg font-semibold transition-all duration-300 ease-in-out bg-transparent text-gray-700 hover:bg-gray-200 hover:text-gray-900 active:scale-95">
                            思考・判断
                        </button>
                    </div>

                    <!-- Feedback Content Areas -->
                    <div id="feedback-knowledge-content-${date}" class="feedback-content">
                        ${topKnowledgeStudents.length > 0 ?
                            topKnowledgeStudents.map(feedback => `
                                <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border-t-4 border-blue-500">
                                    <p class="text-base text-gray-800 mb-3"><strong>出席番号:</strong> ${feedback.studentId}</p>
                                    <div class="mb-4">
                                        <p class="text-sm text-gray-600 font-semibold mb-2">今回の授業の目標:</p>
                                        <p class="text-gray-800 ml-2 leading-relaxed">${feedback.objective}</p>
                                    </div>
                                    <div class="flex flex-col sm:flex-row sm:space-x-6 mb-4">
                                        <div class="flex-1 bg-blue-50 p-5 rounded-xl border border-blue-200 mb-4 sm:mb-0 shadow-sm">
                                            <p class="text-base text-blue-700 font-semibold mb-2">知識・技能: <span class="font-bold text-blue-600">${feedback.knowledgeScore}点</span></p>
                                            <p class="text-blue-800 text-sm leading-relaxed">${feedback.knowledgeText}</p>
                                        </div>
                                        <div class="flex-1 bg-green-50 p-5 rounded-xl border border-green-200 shadow-sm">
                                            <p class="text-base text-emerald-700 font-semibold mb-2">思考・判断: <span class="font-bold text-emerald-600">${feedback.thinkingScore}点</span></p>
                                            <p class="text-emerald-800 text-sm leading-relaxed">${feedback.thinkingText}</p>
                                        </div>
                                    </div>
                                    <div class="bg-yellow-50 p-5 rounded-xl mt-4 border border-yellow-300 shadow-sm">
                                        <p class="text-base text-amber-700 font-semibold mb-2">先生からのコメント:</p>
                                        <p class="text-amber-800 ml-2 leading-relaxed">${feedback.comment}</p>
                                    </div>
                                </div>
                            `).join('')
                            : '<p class="text-gray-500 text-center py-6 bg-gray-50 rounded-xl border border-gray-200">知識・技能で高評価の生徒はいませんでした。</p>'
                        }
                    </div>

                    <div id="feedback-thinking-content-${date}" class="feedback-content hidden">
                        ${topThinkingStudents.length > 0 ?
                            topThinkingStudents.map(feedback => `
                                <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border-t-4 border-emerald-500">
                                    <p class="text-base text-gray-800 mb-3"><strong>出席番号:</strong> ${feedback.studentId}</p>
                                    <div class="mb-4">
                                        <p class="text-sm text-gray-600 font-semibold mb-2">今回の授業の目標:</p>
                                        <p class="text-gray-800 ml-2 leading-relaxed">${feedback.objective}</p>
                                    </div>
                                    <div class="flex flex-col sm:flex-row sm:space-x-6 mb-4">
                                        <div class="flex-1 bg-blue-50 p-5 rounded-xl border border-blue-200 mb-4 sm:mb-0 shadow-sm">
                                            <p class="text-base text-blue-700 font-semibold mb-2">知識・技能: <span class="font-bold text-blue-600">${feedback.knowledgeScore}点</span></p>
                                            <p class="text-blue-800 text-sm leading-relaxed">${feedback.knowledgeText}</p>
                                        </div>
                                        <div class="flex-1 bg-green-50 p-5 rounded-xl border border-green-200 shadow-sm">
                                            <p class="text-base text-emerald-700 font-semibold mb-2">思考・判断: <span class="font-bold text-emerald-600">${feedback.thinkingScore}点</span></p>
                                            <p class="text-emerald-800 text-sm leading-relaxed">${feedback.thinkingText}</p>
                                        </div>
                                    </div>
                                    <div class="bg-yellow-50 p-5 rounded-xl mt-4 border border-yellow-300 shadow-sm">
                                        <p class="text-base text-amber-700 font-semibold mb-2">先生からのコメント:</p>
                                        <p class="text-amber-800 ml-2 leading-relaxed">${feedback.comment}</p>
                                    </div>
                                </div>
                            `).join('')
                            : '<p class="text-gray-500 text-center py-6 bg-gray-50 rounded-xl border border-gray-200">思考・判断で高評価の生徒はいませんでした。</p>'
                        }
                    </div>
                </div>
            `;
            dateAnalysisContent.appendChild(sectionDiv);

            // Add event listeners for new feedback tabs after they are rendered
            document.getElementById(`feedback-knowledge-tab-btn-${date}`).addEventListener('click', () => {
                showFeedbackTab('knowledge', date);
            });
            document.getElementById(`feedback-thinking-tab-btn-${date}`).addEventListener('click', () => {
                showFeedbackTab('thinking', date);
            });

            // Create new charts and store instances
            currentChartInstances[`knowledgeChart-${date}`] = createPieChart(`knowledgeChart-${date}`, dataForDate.knowledgeScores, knowledgeColors);
            currentChartInstances[`thinkingChart-${date}`] = createPieChart(`thinkingChart-${date}`, dataForDate.thinkingScores, thinkingColors);
        }

        // Function to switch between knowledge and thinking feedback tabs
        function showFeedbackTab(tabType, date) {
            const knowledgeBtn = document.getElementById(`feedback-knowledge-tab-btn-${date}`);
            const thinkingBtn = document.getElementById(`feedback-thinking-tab-btn-${date}`);
            const knowledgeContent = document.getElementById(`feedback-knowledge-content-${date}`);
            const thinkingContent = document.getElementById(`feedback-thinking-content-${date}`);

            if (tabType === 'knowledge') {
                knowledgeBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                knowledgeBtn.classList.remove('bg-transparent', 'text-gray-700', 'hover:bg-gray-200', 'hover:text-gray-900');
                thinkingBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                thinkingBtn.classList.add('bg-transparent', 'text-gray-700', 'hover:bg-gray-200', 'hover:text-gray-900');
                knowledgeContent.classList.remove('hidden');
                thinkingContent.classList.add('hidden');
            } else { // thinking
                thinkingBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                thinkingBtn.classList.remove('bg-transparent', 'text-gray-700', 'hover:bg-gray-200', 'hover:text-gray-900');
                knowledgeBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                knowledgeBtn.classList.add('bg-transparent', 'text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
                knowledgeContent.classList.add('hidden');
                thinkingContent.classList.remove('hidden');
            }
        }

        // Helper function to create a pie chart
        function createPieChart(canvasId, scoresData, colors) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null; // Ensure canvas exists

            // Sort data by score in descending order for clockwise display
            const sortedEntries = Object.entries(scoresData)
                .filter(([key, value]) => value > 0)
                .sort(([key, value]) => parseInt(key)) // Sort ascending by score for Chart.js pie chart order
                .reverse(); // Reverse to get descending order for visual display

            const labels = sortedEntries.map(([key, value]) => `${key}点`);
            const data = sortedEntries.map(([key, value]) => value);
            
            // If no data to display (all scores are 0 for this date/category)
            if (data.every(val => val === 0)) {
                const parentDiv = ctx.parentElement;
                parentDiv.innerHTML = `<p class="text-center text-gray-500 text-base mt-4">この日のデータはありません。</p>`;
                return null;
            }

            // Map labels to colors based on sorted score values
            const backgroundColors = sortedEntries.map(([key, value]) => colors[parseInt(key)]);
            const borderColors = backgroundColors.map(color => {
                // Simple darkening for border (can be more sophisticated)
                const rgb = color.match(/\d+/g);
                return `rgb(${Math.round(rgb[0] * 0.9)}, ${Math.round(rgb[1] * 0.9)}, ${Math.round(rgb[2] * 0.9)})`;
            });

            return new Chart(ctx.getContext('2d'), {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right', // Position legend to the right
                            labels: {
                                color: '#4b5563', // Tailwind's gray-700
                                font: {
                                    size: 14,
                                    weight: '500'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += `${context.parsed}人`;
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    layout: {
                        padding: 10 // Add some padding around the chart
                    }
                }
            });
        }

        // Function to get learning content based on date (hardcoded for now)
        function getLearningContentForDate(date) {
            switch(date) {
                case '2025年06月02日':
                    return 'この日は、因数分解、たすき掛け、そして複数の文字を含む式の整理方法について学びました。複雑な式を単純化し、効率的に解くための基礎を固めることに焦点を当てました。生徒たちは、文字に置き換える工夫や、様々な解法があることを学び、実践しました。';
                case '2025年06月03日':
                    return 'この日は、中学校で習った有理数、有限小数、無理数などを復習し、理解を深めました。特に絶対値の概念、その表記法、そして|√2−5|のような複雑な形での計算方法について学びました。循環小数の表し方についても触れました。';
                case '2025年06月10日':
                    return 'この日は、ルートを使った分母の有理化の方法を思い出し、因数分解を活用した有理化の方法を習得しました。分母にルートの和や差がある場合の有理化（例：√5＋√3）に焦点を当て、約分を意識した効率的な計算方法を学びました。';
                case '2025年06月16日':
                    return 'この日は、一次不等式の解き方とそのルール、特に負の数で割る際の不等号の向きの変化について学びました。カッコを含む不等式の解法や、割り切れない場合の表現方法についても触れ、計算ミスを防ぐための注意点を確認しました。';
                default:
                    return 'この日の学習内容はまだ登録されていません。';
            }
        }

        // Tab switching logic
        function activateTab(tabName) {
            const studentTabBtn = document.getElementById('student-tab-btn');
            const analysisTabBtn = document.getElementById('analysis-tab-btn');
            const studentTabContent = document.getElementById('student-reports-tab');
            const analysisTabContent = document.getElementById('analysis-tab');

            if (tabName === 'student') {
                studentTabBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                studentTabBtn.classList.remove('bg-transparent', 'text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
                analysisTabBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                analysisTabBtn.classList.add('bg-transparent', 'text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
                studentTabContent.classList.remove('hidden');
                analysisTabContent.classList.add('hidden');
                // Ensure initial student report is shown if a student is already selected
                const selectedStudentId = document.getElementById('student-select').value;
                if (selectedStudentId) {
                    renderStudentReports(selectedStudentId);
                } else {
                     document.getElementById('student-reports-content').innerHTML = `
                        <div class="flex items-center justify-center p-16 text-gray-500 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                            <p class="text-xl font-medium">出席番号を選択してレポートを表示してください。</p>
                        </div>
                    `;
                }
            } else { // analysis
                analysisTabBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                analysisTabBtn.classList.remove('bg-transparent', 'text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
                studentTabBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                studentTabBtn.classList.add('bg-transparent', 'text-gray-700', 'hover:bg-gray-100', 'hover:text-gray-900');
                studentTabContent.classList.add('hidden');
                analysisTabContent.classList.remove('hidden');
                
                // Aggregate and render analysis charts when tab is activated
                aggregateAnalysisData(); 
                renderAnalysisReports();
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            parseReportData(rawReportData);

            const studentSelect = document.getElementById('student-select');
            const studentTabBtn = document.getElementById('student-tab-btn');
            const analysisTabBtn = document.getElementById('analysis-tab-btn');

            // Populate the student select dropdown
            const studentIds = Object.keys(parsedReports).sort((a, b) => parseInt(a) - parseInt(b));
            studentIds.forEach(id => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = `出席番号: ${id}`;
                studentSelect.appendChild(option);
            });

            // Event listener for student selection change
            studentSelect.addEventListener('change', (event) => {
                const selectedStudentId = event.target.value;
                renderStudentReports(selectedStudentId);
            });

            // Event listeners for tab buttons (inside main app)
            studentTabBtn.addEventListener('click', () => activateTab('student'));
            analysisTabBtn.addEventListener('click', () => activateTab('analysis'));

            // Activate student tab by default on load
            activateTab('student');
        });
    </script>
</body>
</html>
